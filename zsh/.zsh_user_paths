#!/usr/bin/env zsh
# vim: awa:sts=4:ts=4:sw=4:et:cin:fdm=manual:tw=120:ft=zsh

add_dir_to_path() {
    [ -d "$1" ] && export PATH="$1:$PATH"
}

add_dir_to_pkg_config_path() {
    if [[ -d "$1" ]] then
        if [[ $PKG_CONFIG_PATH && ${PKG_CONFIG_PATH-x} ]] then
            export PKG_CONFIG_PATH="$PKG_CONFIG_PATH:$1"
        else
            export PKG_CONFIG_PATH="$1"
        fi
    fi
}

add_dir_to_include_path() {
    if [[ -d "$1" ]] then
        if [[ $CPPFLAGS && ${CPPFLAGS-x} ]] then
            export CPPFLAGS="$CPPFLAGS -isystem$1"
        else
            export CPPFLAGS="-isystem$1"
        fi
    fi
}

add_dir_to_linker_path() {
    if [[ -d "$1" ]] then
        if [[ $LDFLAGS && ${LDFLAGS-x} ]] then
            export LDFLAGS="$LDFLAGS -L$1"
        else
            export LDFLAGS="-L$1"
        fi
    fi
}

export PATH="$PATH:."
add_dir_to_path "/usr/local/sbin"
add_dir_to_path "/usr/local/bin"
add_dir_to_path "$HOME/settings"
add_dir_to_path "$HOME/scripts"
add_dir_to_path "$HOME/.local/bin"
add_dir_to_path "$HOME/.cargo/bin"

# For using a2x for manpage generation
[ -e "/usr/local/etc/xml/catalog" ] && export XML_CATALOG_FILES="/usr/local/etc/xml/catalog"

if [[ "$(uname)" == "Darwin" ]] then
    # Setup the perl environment
    [ -e "$HOME/perl5/perlbrew/etc/bashrc" ] && source "$HOME/perl5/perlbrew/etc/bashrc"

    # Setup JAVA environment variables
    [ -x "/usr/libexec/java_home" ] && export JAVA_HOME=$(/usr/libexec/java_home)

    # Setup LLVM/clang C++ environment variables
    add_dir_to_include_path "/usr/local/opt/llvm/include"
    add_dir_to_linker_path "/usr/local/opt/llvm/lib"
    add_dir_to_path "/usr/local/opt/llvm/bin"

    # Add all of the gnu-variant duplicate (newer) versions of binaries
    add_dir_to_path "/usr/local/opt/unzip/bin"
    add_dir_to_path "/usr/local/opt/curl/bin"
    add_dir_to_path "/usr/local/opt/coreutils/libexec/gnubin"
    add_dir_to_path "/usr/local/opt/make/libexec/gnubin"
    add_dir_to_path "/usr/local/opt/grep/libexec/gnubin"
    add_dir_to_path "/usr/local/opt/gnu-sed/libexec/gnubin"
    add_dir_to_path "/usr/local/opt/gnu-getopt/bin"

    # Setup ruby binaries before system ruby
    add_dir_to_path "/usr/local/opt/ruby/bin"

    # Setup Python-3.7 environment variables
    add_dir_to_path "$HOME/Library/Python/3.7/bin"

    add_dir_to_pkg_config_path "$(brew --prefix python3)/Frameworks/Python.framework/Versions/Current/lib/pkgconfig"
    add_dir_to_pkg_config_path "$(brew --prefix qt5)/lib/pkgconfig"
    add_dir_to_pkg_config_path "$(brew --prefix oniguruma)/lib/pkgconfig"

    add_dir_to_include_path "/usr/local/opt/qt/include"
    add_dir_to_linker_path "/usr/local/opt/qt/lib"

    # Setup MacVim environment variables
    add_dir_to_path "/Applications/MacVim.app/Contents/bin"
elif [[ "$(uname -s)" == "Linux" ]] then
    if [[ -d "/usr/lib/jvm/java-11-openjdk-amd64" ]] then
        # Setup JAVA environment variables
        export JAVA_HOME="/usr/lib/jvm/java-11-openjdk-amd64"
        add_dir_to_path "$JAVA_HOME/bin"
    fi
fi

# Always use vim as the editor of choice -- the only thing we can depend on always being installed!
export EDITOR='vim'

# RipGrep needs to know where its configuration file is located
[ -e "$HOME/.config/ripgrep/.ripgreprc" ] && export RIPGREP_CONFIG_PATH=$HOME/.config/ripgrep/.ripgreprc

# Setup golang environment variables
if [[ -d "/usr/local/go" ]] then
    export GOROOT=/usr/local/go
    [ -z "${GOPATH+x}" ] && export GOPATH="$HOME/go"
    mkdir -p "$GOPATH/bin"
    add_dir_to_path "$GOPATH/bin"
    add_dir_to_path "$GOROOT/bin"
fi

unset add_dir_to_path
unset add_dir_to_pkg_config_path
unset add_dir_to_include_path
unset add_dir_to_linker_path

